# Dynamic Malware Analysis

## Motivation
Virus companies get tons of virus samples every day. We want a way to *dynamically* analyze samples by executing and verifying the actions it performs in practice, such that we can recognize new [[malware|Malware]] on encounter.

### Problems
1. Malware must be submitted, identified, then distributed via antivirus. Antivirus can't adapt to new threats.
1. Antivirus often doesn't help against targeted attacks which don't do generalizable things.

## Terms and Definitions

* **Function hooking** - with only the binary, we can either 1) rewrite the called function to invoke a hook or 2) modify call sites to call the hook instead
* **Trampoline** - a binary function proxy. You call functions (usually per-missioned) and it calls scarier functions like system calls.
* **Information flow control** - tracking data as it moves from a *source* to a *sink*. See [[Taint-Analysis]].

### Types of Malware
1. **Worm** - replicates itself across a network or other medium, usually with the goal of creating a botnet. 
1. **Virus** - Adds itself to other programs and uses a host program to hide itself.
1. **Trojan horse** - pretends to be useful but contains malicious code
1. **Spyware** - retrieves sensitive information from victim's system
1. **Bot** - Remotely controlled
1. **Rootkit** - hides presence and suborbital instruments the operation of the computer or program in some way

See [[Famous-Malware]].

### Infection Vectors
1. Exploiting vulnerable services open via the network
1. **Drive-by downloads** - getting the user to download a file and execute it either willingly or unwillingly
1. Social engineering

## Overview
* We can analyze function calls via function hooking. We can compare function behavior of a program to normal call graphs of normal programs.
* We can analyze the function arguments sent to system calls and the like. By implementing trampolines to system calls that analyze arguments.
* Using IFC to see if data is sent to places we don't want it to be sent to.

We can perform analysis at the user/kernel level using something like `ptrace`, or `strace`. We can also create an emulator and run the program there, which gives us full control. An emulator differs from a VM in that a VM is the same architecture as the hardware the VM runs on.

* We often need to simulate network traffic so malware can contact the network.

